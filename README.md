# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Типы данных и интерфейсы приложения

описывает структуру данных товара
```
interface ICard {
	id: string; - идентификатор товара
    description: string; - описание товара
    image: string; - url товара
    title: string; - название товара
    category: string; - категория товара
    price: number | null; - цена товара
    cardButton: string;
}
```
описывает интерфейс пользователя
```
type TPayment  = 'cash' | 'card'; - тип способа оплаты \

interface IUser {
	payment: TPayment | string; - способ оплаты товара
    email: string; - элетронный адрес пользователя
    phone: string; - телефон пользователя
    address: string; - адрес доставки
    total: number; - полная стоимость товара 
    items: string []; 
}
```
описывает структуру данных массива карточек
```
interface ICardsList {
    cards: ICard[]; - массив карточек
    count: number; - стоимости 
    getCard(cardId: string): ICard | undefined; 
}
```
описание стркутуры данных корзины
```
interface IBasket{
    cards: ICard[]; // массив товаров в корзине
    total: number;
}
```
описание структуры данных главной страницы
```
interface IPage {
    count: number; - количество карточек
    gallery: HTMLElement[]; - галерея карточек
    closed: boolean; - блокировка страницы
}
```
описание структуры данных способа оплаты и адреса
```
interface IOrder {
    payment: string; - способ оплаты
    address: string; - адрес
}
```
описание структуры данных электронного адреса и телефона
```
interface IContacts {
    email: string; - электронный адрес
    phone: string; - телефон
}
```
описание стркутуры для отображения успешного завершения заказа
```
interface ISuccess {
    total: number; - окончательная стоимость
}
```
типизация данных пользвателя в модальном окне с выбором способа оплаты и указания адреса отправки
```
type UserPayAndDelivery = Pick<IUser, 'payment' | 'address'>; 
```
типизация данных пользвателя в модальном окне с выбором способа оплаты и указания адреса отправки 
```
type UserEmailAndPhone = Pick<IUser, 'email' | 'phone'>; 
```
типизация методов Api
```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE' | 'PATCH';
```

## Архитектура приложения

Приложение основано на архитектурном паттерне проектирования MVP, при котором приложение разделяют на три основных компонента:
1. Model. Отвечает за данные и бизнес-логику;
2. View. Отвечает за представление данных и взаимодействие с пользователем;
3. Presenter. Обрабатывает пользовательские события и обновляет Model и View.

### Базовый код

#### Api

Класс Api Содержит в себе базовую логику отправки запросов.

Методы класса:

readonly baseUrl: string - поле с базовым адресом сервера;

protected options: RequestInit - поле опций вызова запроса.

Конструктор constructor(baseUrl: string, options: RequestInit = {}) - принимает в качестве аргументов базовый адрес url
и опции запросов, и устанавливает в свои поля базовый адрес сервера и описание для формирования запроса.

Имеет методы:

- `get` - выполняет GET запрос и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на сервер. 
- `handleResponse(response: Response): Promise<object>` - обрабатывает ответ сервера, проверяет статус ответа
и если ответ успешный (response.ok), возвращает распарсенный JSON, 
если ошибка, пытается извлечь сообщение об ошибке из тела ответа или использует statusText.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе.
Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

#### Класс Component

Абстрактный класс является дженериком и родителем всех компонентов слоя представления.
В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте.
В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента.
Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры,
возвращает обновленный контейнер компонента.

Методы:

- `toggleClass(element: HTMLElement, className: string)` - принимает элемент и имя класса, добавляет или удаляет класс в зависимости от наличия или отсутствия;
- `addClass(element: HTMLElement, className: string)` - принимает элемент и имя класса, добавляет класс элементу;
-  `setText(element: HTMLElement, value: unknown)` - принимает элемент и данные неизвестного типа, добавляет данные внутрь элемента в виде текста или дочерних элементов;
- `setDisabled(element: HTMLElement, state: boolean)` - принимает элемент и статут активации, делает элемент активным или неактивным с в зависимости от статуса;
- `setHidden(element: HTMLElement)` - принимает элемент, добавляет в стиль элемента атрибут display: "none";
- `setVisible(element: HTMLElement)` - принимает элемент и удаляет из стилей атрибут display;
- `setImage(element: HTMLImageElement, src: string, alt?: string)` - принимает элемент, ссылку на адрес, тест с описанием (опционально), добавляет изображение в элемент;
- `render(data?: Partial<T>): HTMLElement` - принимает опционально данные определенного типа, возвращает DOM элемент.

### Классы представления

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна.\
Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор,\
по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс Page

Класс представления Главной страницы приложения, наследуется от абстрактного класса Component.

Поля класса: 

- _pageWrapper: HTMLElement; - обертка страницы
- _headerBasket: HTMLButtonElement; - иконка корзины
- _headerBasketCounter: HTMLSpanElement; - количество карточек в корзине
- _gallery: HTMLElement; - массив карточек

Методы:

- `set gallery(items: HTMLElement[])` - сохраняет галерею карточек
- `set pageLocked(value: boolean)` - добавляет или удаляет класс блокировки в зависимости от открытия модульного окна
- `setBasketCounter(value: number)` - сохраняет количество карточек 

#### Form

Этот класс обеспечивает функциональность для работы с формами,
включая обработку ввода данных, валидацию, отображение ошибок и т. д., наследует класс Component

constructor(protected container: HTMLFormElement, protected events: IEvents) - конструктор классов вызывает конструктор родительского класса Component \
и инициализирует защищенные поля _submitи _errors, которые представляют собой кнопку отправки формы и элемент для отображения ошибок соответственно.\
Также создают обработчики событий для ввода данных и отправки форм

- `onInputChange(field: keyof T, value: string)` - защищенный метод для обработки изменений ввода данных
- `set valid(value: boolean)`-  сеттер для установки состояния валидности формы
- `set errors(value: string)`- сеттер для установки текста ошибок
- `render(state: Partial & IFormState)` - метод для отрисовки форм

#### ContactsForm

Класс представления формы заказа, в котором пользователь вносит свои контактные данные (электронный адрес и почту).
Наследуется от абстрактного класса Form. 

Методы:

- `set phone(value: string)` - сохранение телефона 
- `set email(value: string)` - сохранение электронного адреса

#### OrderForm

Класс представления формы заказа, в котором пользователь указывает способ оплаты за заказ и вносить свой адрес.
Наследуется от абстрактного класса Form. 

Поля:

- _paymentButtons: Record<TPayment, HTMLButtonElement>; - способы оплаты
- _activePayment: TPayment = 'card'; - дефолтное значение оплаты

Методы:

- `private setupPaymentButtons(): void`- метод настройки обработчиков кликов для кнопок выбора способа оплаты
- `private setPaymentMethod(method: TPayment): void` - выбор способа оплаты при клике на конкретную кнопку и добавление этой кнопке модификатор активности
- `get paymentMethod(): TPayment` - получение способа оплаты
- `set address(value: string)` - сохранение адреса

#### Класс Basket

Класс представления корзины приложения. Наследуется от абстрактного класса Component. 

Поля класса:

- _basketList: HTMLElement; - список товаров
- _basketButton: HTMLButtonElement; - кнопка оформления заказа
- _basketPrice: HTMLSpanElement; - общая стоимость заказа
- _basketItemDelete: HTMLButtonElement; - кнопка удаления карточки
- events: IEvents; - система событий

Методы:

- `set updateButton(items: ICard[])` - обновляет состояние кнопки корзины, делает кнопку корзины активной,
если есть карточки с ценой больше нуля или неактивной \
- `set price(value: number)` - сохраняет общую стоимость карточек в корзине
- `set cards(items: HTMLElement[])` - обновляет количество карточек в корзине

#### Класс Card

Класс представления карточки приложения. Наследуется от абстрактного класса Component. 

- cardId: string; - ID карточки
- cardText: HTMLElement; - описание карточки
- cardImage: HTMLImageElement; - картинка карточки
- cardTitle: HTMLElement; - название карточки
- cardCategory: HTMLElement; - категория карточки
- cardPrice: HTMLElement; - цена карточки
- cardButton: HTMLButtonElement; - кнопка добавления карточки в корзину
- cardIndex: HTMLElement; - интекс карточки
- events: IEvents; - система событий;

Поля класса:

- `get id` - получение ID карточки
- `set id(id)`-сохранение ID карточки
- `set description(description: string)` - сохранение описания карточки 
- `set image(value: string)` - сохранение картинки карточки
- `set title(title: string)` - сохранение названия карточки
- `set category(category: string)` - сохранение описания карточки
- `set price(price: number | null)` - сохранение цены карточки
- `get indexCard(): string` - получение индекса карточки
- `set indexCard(value: string | string[])` - сохранение индекса карточки

#### Success

Класс представления модального окна при успешном завершении заказа. Наследуется от абстрактного класса Component. 

Поля:

- orderSuccessDescription: HTMLElement; - описание заказа
- orderSuccessClose: HTMLButtonElement; - кнопка закрытия окна
- events: IEvents;

Методы:

- `set total(value: number)`- сохраняет окончательную стоимость заказа

### Слой данных

#### Класс CardsData

Класс отвечает за хранение и логику работы с данными карточек полученных с сервера. Реализовывает интерфейс ICardsList.
Конструктор класса принимает инстант брокера событий.

Поля:

- _cards: ICard[]; - массив карточек
- _preview: string | null; - превью
- _count: number; - количество карточек
- events: IEvents;

Методы:

- `get cards(): ICard[]`- получение массива карточек
- `set cards(value: ICard[])` - сохранение массива карточек и количества карточек
- `getCard(cardId: string)` - получение карточки по id
- `setPreview(card: ICard): void` - сохранение карточки по id для превью
- `get preview(): string | null` - превью карточки
- `get count(): number` - получение количества карточек
- `set count(value: number)` - сохранение количества карточек

#### Класс BasketData

Класс отвечает за хранение и логику работы с данными карточек добавленными в корзину и дальнейшего оформления заказа при наличии карточек в корзине.
Реализовывает интерфейс IBasket.
Конструктор класса принимает инстант брокера событий.

Поля:

- _cards: ICard[]; - массив карточек
- _total: number; - общая стоимость карточек
- events: IEvents;

Методы:

- `get cards(): ICard[]`- получение массива карточек
- `get total(): number` - получение общей стоимости карточек
- `private cardInBasket(item: ICard): boolean` - проверяет добавлена ли карточка в корзину
- `getButtonStatus(item: ICard): string` - изменяет статус кнопки в заисимости от стоимости карточки
- `addCard(item: ICard): void` - добавляете карточку в корзину
- `removeItemFromBasket(item: ICard): void` - удаляет карточку из корзины
- `clearBasket(): void` - очищает корзину

#### Класс OrderData

Класс отвечает за хранение и логику работы с данными пользователя.
Реализовывает интерфейс IUser.
Конструктор класса принимает инстант брокера событий.

Поля:

- _payment: TPayment | string = ''; - способ оплаты
- _email = ''; - электронный адрес
- _phone = ''; - телефон
- _address = ''; - адресс
- _total = 0; - цена заказа
- _items: string[] = []; - массив id карточек
- formErrors: Partial<Record<keyof IUser, string>> = {}; - хранит ошибки валидации
- events: IEvents; - система событий

Методы:

- `set payment(value: TPayment | string)`- сохранение способа оплаты
- `set email(value: string)` - сохранение электронного адреса
- `set phone(value: string)` - сохранение телефона
- `set address(value: string)` - сохранение адреса
- `set total(value: number)` - сохранение цены
- `setOrderField(field: keyof Pick<UserPayAndDelivery, 'payment' | 'address'>, value: string)` - проверка запполения способа оплаты и адреса пользователем
- `setContactsField(field: keyof Pick<UserEmailAndPhone, 'email' | 'phone'>, value: string)` - проверка запполения электронного адреса и телефона ползователем
- `validateOrder(): boolean` - валидации при заполнении способа оплаты и адреса пользователем
- `validateInfo(): boolean` - валидации при заполнении электронного адреса и телефона ползователем
- `validateInfo(): boolean` - валидации при заполнении электронного адреса и телефона ползователем
- `clearOrder(): void` - очистка форм
- `getOrderData(): IUser` - получение данных

#### Класс SuccessData

Класс отвечает за хранение и логику работы с модальным окном при завершении заказа.
Реализовывает интерфейс ISuccess.
Конструктор класса принимает инстант брокера событий.

Поля:

- _total: number; - окончательнная стоимости заказа
- events: IEvents; - брокер событий

Методы:

- `get total(): number`- получение общей стоимости заказа
- `set total(value: number)` - сохранение общей стоимости заказа

### Слой коммуникации

#### Класс AppApi

Наследуется от класса Api и реализовывает интерфейс IAppApi. 
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Методы:

- `getCardList(): Promise<ICard[]>`- получение массиива карточек с сервера
- `orderUserResult(order: IUser): Promise<IUserResult>` - отправка данных пользователя на сервер

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*

- `preview:change` - изменение данных при превью
- `cards:changed` - изменение данных массива карточек
- `orderErrors:change` - изменение данных с ошибками 
- `contactsErrors:change` - изменение контактных данных с ошибками 

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `order:open`- открытие модального окна заказа
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `order:ready` - заполнена форма данных
- `contacts:ready` - заполнены форма контаактных данных
- `orderDate:validation` - валидация данных
- `contactsDate:validation` - валидация контакных данных
- `basket:open` - открыть корзину
- `card:selected` - выбрана карточка
- `card:basket` - карточка в корзине
- `card:delete` - карточка удалена из корзины
- `order:submit` - отправлена форма с данными
- `contacts:submit` - отправлена форма с контактными данными